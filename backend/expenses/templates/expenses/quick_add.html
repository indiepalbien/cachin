{% extends 'base.html' %}

{% block title %}AÃ±adir TransacciÃ³n â€” App-Finanzas{% endblock %}

{% block content %}

<h1 class="text-2xl md:text-3xl font-extrabold mb-6">AÃ±adir TransacciÃ³n</h1>

<!-- Quick-add form -->
<section id="quick-add" class="my-4 p-3 md:p-4 border-3 border-accent bg-panel rounded shadow-brutal">
  <form id="quick-add-form"
        hx-post="{% url 'expenses:quick_transaction' %}"
        hx-target="#qa-msg"
        hx-swap="innerHTML"
        hx-indicator="#qa-submit">
    {% csrf_token %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
      <input name="description" id="qa-description" placeholder="DescripciÃ³n*" required
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">

      <input name="amount" id="qa-amount" type="number" step="0.01" placeholder="Ej: 123.45" required
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px] [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">

      <input name="date" id="qa-date" type="date" required
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">

      <input name="currency" id="qa-currency" list="qa-currencies" placeholder="EUR* / USD*" maxlength="3" required
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">
      <datalist id="qa-currencies">
        <option value="USD">
        <option value="EUR">
        <option value="UYU">
        <option value="ARS">
        <option value="BRL">
        <option value="GBP">
        <option value="CLP">
        <option value="MXN">
      </datalist>

      <input name="category" id="qa-category" list="qa-categorys" placeholder="CategorÃ­a..."
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">
      <datalist id="qa-categorys">
        {% for name in qa_categories %}
          <option value="{{ name }}">
        {% endfor %}
      </datalist>

      <input name="project" id="qa-project" list="qa-projects" placeholder="Proyecto..."
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">
      <datalist id="qa-projects">
        {% for name in qa_projects %}
          <option value="{{ name }}">
        {% endfor %}
      </datalist>

      <input name="payee" id="qa-payee" list="qa-payees" placeholder="Beneficiario..."
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">
      <datalist id="qa-payees">
        {% for name in qa_payees %}
          <option value="{{ name }}">
        {% endfor %}
      </datalist>

      <input name="source" id="qa-source" list="qa-sources" placeholder="Origen..."
             class="w-full px-3 py-2 border-2 border-slate-300 rounded focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 min-h-[44px]">
      <datalist id="qa-sources">
        {% for name in qa_sources %}
          <option value="{{ name }}">
        {% endfor %}
      </datalist>

      <button id="qa-submit" type="submit"
              class="col-span-full bg-accent text-white px-4 py-3 border-0 rounded font-bold cursor-pointer transition-all shadow-brutal hover:-translate-y-0.5 hover:shadow-brutal-lg min-h-[44px]">
        <span class="htmx-indicator hidden">Guardando...</span>
        <span class="normal-text">AÃ±adir</span>
      </button>
    </div>
  </form>
  <div id="qa-msg" aria-live="polite" class="mt-2 min-h-[1.5rem]"></div>

  <style>
    #qa-submit.htmx-request .htmx-indicator { display: inline; }
    #qa-submit.htmx-request .normal-text { display: none; }
  </style>

  <script>
    // Set default date on page load
    document.addEventListener('DOMContentLoaded', function() {
      const dateInput = document.getElementById('qa-date');
      if (dateInput && !dateInput.value) {
        dateInput.value = new Date().toISOString().slice(0,10);
      }
    });
    // Reset form and go to profile after successful submission
    document.getElementById('quick-add-form').addEventListener('htmx:afterRequest', function(evt) {
      if (evt.detail.successful) {
        this.reset();
        document.getElementById('qa-date').value = new Date().toISOString().slice(0,10);
        setTimeout(() => window.location.href = "{% url 'profile' %}", 700);
      }
    });
  </script>

  <!-- Bulk import and image upload links -->
  <div class="mt-6 pt-4 border-t border-dashed border-accent space-y-3">
    <h3 class="text-lg font-bold mb-3">Otras opciones</h3>
    <div>
      <a href="{% url 'expenses:bulk_add' %}"
         class="inline-flex items-center gap-2 px-4 py-2 bg-accent text-bg no-underline rounded font-medium transition-opacity hover:opacity-80 min-h-[44px]">
        ðŸ“‹ Importar mÃºltiples transacciones
      </a>
      <span class="ml-2 text-muted text-sm">
        Copiar y pegar desde tu banco
      </span>
    </div>

    <div>
      <a href="{% url 'expenses:image_upload' %}"
         class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white no-underline rounded font-medium transition-opacity hover:opacity-80 min-h-[44px]">
        ðŸ“· Subir imÃ¡genes de transacciones
      </a>
      <span class="ml-2 text-muted text-sm">
        Procesar recibos y capturas con IA
      </span>
    </div>
  </div>
</section>

{% endblock %}
